default_platform(:android)

platform :android do

  lane :test do
    gradle(task: "test")
  end

  lane :deploy_debug do
    gradle(task: "assembleDebug")
  end

  lane :deploy_release do |options|
    
    gradle(
      task: "assembleRelease",
      properties: {
        "android.injected.signing.store.file" => "app/release-key.jks",
        "android.injected.signing.store.password" => ENV['STORE_PASSWORD'],
        "android.injected.signing.key.alias" => ENV['KEY_ALIAS'],
        "android.injected.signing.key.password" => ENV['KEY_PASSWORD'],
      }
    )
    
    set_github_release(
      repository_name: ENV['GITHUB_REPOSITORY'],
      api_token: ENV['GITHUB_TOKEN'],
      name: "Release #{options[:version]}",
      tag_name: options[:version],
      description: "Automated release generated by Fastlane via GitHub Actions.",
      upload_assets: ["app/build/outputs/apk/release/app-release.apk"]
    )
    
    # Optional: Uncomment to deploy to Google Play (requires 'supply' setup)
    # supply(
    #   apk: "app/build/outputs/apk/release/app-release.apk"
    # )
  end
end
