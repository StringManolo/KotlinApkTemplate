default_platform(:android)

platform :android do

  desc "Runs all the tests"
  lane :test do
    gradle(task: "test")
  end

  desc "Submit a new Debug Build"
  lane :build_debug do
    gradle(task: "assembleDebug")
  end

  desc "Build a signed Release APK and create a GitHub Release"
  lane :release_github do |options|
    gradle(
      task: "assembleRelease",
      properties: {
        "android.injected.signing.store.file" => "release-key.jks",
        "android.injected.signing.store.password" => ENV['STORE_PASSWORD'],
        "android.injected.signing.key.alias" => ENV['KEY_ALIAS'],
        "android.injected.signing.key.password" => ENV['KEY_PASSWORD'],
      }
    )

    set_github_release(
      repository_name: "#{ENV['GITHUB_REPOSITORY']}",
      api_token: ENV['GITHUB_TOKEN'],
      name: "Release #{options[:version]}",
      tag_name: options[:version],
      description: "Automated release generated by Fastlane via GitHub Actions.",
      upload_assets: ["app/build/outputs/apk/release/app-release.apk"]
    )

    # If you want to automate store submission (Play Store), uncomment the following line
    # and ensure you have configured Google Play Console credentials and metadata in fastlane/metadata/android/
    # supply(metadata_path: "fastlane/metadata/android/", apk: "app/build/outputs/apk/release/app-release.apk")
  end

end
